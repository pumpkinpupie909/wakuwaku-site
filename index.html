<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>わくわくの実 厳選メモ</title>

<style>
  body {
    font-family: "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    margin: 0;
    padding: 20px;
    background: #f5f5f5;
  }
  h1 { text-align: center; margin-bottom: 20px; }
  .form-area, .list-area {
    background: #fff;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 20px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    margin-bottom: 15px;
    border-radius: 8px;
    border: 1px solid #ccc;
  }
  button {
    padding: 10px 12px;
    border: none;
    border-radius: 8px;
    background: #4caf50;
    color: #fff;
    cursor: pointer;
    width: 100%;
  }
  button:hover { opacity: 0.8; }
  .item-card{
    background: #fff;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.08);
  }
  .top-row{
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
  }

  .priority-high { color: red; font-weight: bold; }
  .priority-mid  { color: orange; font-weight: bold; }
  .priority-low  { color: green; font-weight: bold; }
</style>

</head>
<body>

<h1>わくわくの実 厳選メモ</h1>

<!-- ▼ 検索欄 -->
<input
  type="text"
  id="searchBox"
  placeholder="キャラ名で検索"
  oninput="render()"
  style="width: 100%; padding: 10px; border-radius: 8px; margin-bottom: 15px;"
>

<!-- ▼ 入力フォーム -->
<div class="form-area">
  <h2>追加</h2>

  <label>キャラクター名</label>
  <input type="text" id="charName">

  <label>優先度</label>
  <select id="priority">
    <option value="高">高</option>
    <option value="中">中</option>
    <option value="低">低</option>
  </select>

  <label>1体目</label><input type="text" id="slot1">
  <label>2体目</label><input type="text" id="slot2">
  <label>3体目</label><input type="text" id="slot3">
  <label>4体目</label><input type="text" id="slot4">
  <label>5体目</label><input type="text" id="slot5">

  <button onclick="addItem()">追加する</button>
</div>

<!-- ▼ 一覧 -->
<div class="list-area">
  <h2>一覧</h2>
  <div id="itemList"></div>
</div>

<!-- ▼ Firebase 読み込み（スマホ用・script タグ） -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, getDocs, setDoc, doc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCemWjfIYdU9FxPTphyq7l29wmDtoOlgk4",
    authDomain: "wakuwaku-app.firebaseapp.com",
    projectId: "wakuwaku-app",
    storageBucket: "wakuwaku-app.firebasestorage.app",
    messagingSenderId: "310292669144",
    appId: "1:310292669144:web:a6b7943f62d2868f1eadad"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let list = [];

  // ▼ データ読み込み（起動時）
  async function load(){
    const snap = await getDocs(collection(db, "wakuList"));
    list = snap.docs.map(d => d.data());
    render();
  }
  load();

  // ▼ 保存（全上書き方式）
  async function save(){
    for(const item of list){
      await setDoc(doc(db, "wakuList", String(item.id)), item);
    }
  }

  // ▼ 追加
  window.addItem = function (){
    const newItem = {
      id: Date.now(),
      name: charName.value,
      priority: priority.value,
      slots: [
        slot1.value, slot2.value, slot3.value,
        slot4.value, slot5.value
      ],
      done: false
    };

    list.push(newItem);
    save();
    render();
  };

  // ▼ 完了フラグ
  window.toggleDone = function(id){
    const item = list.find(x => x.id === id);
    item.done = !item.done;

    // 完了したものは下へ
    list.sort((a,b)=> a.done - b.done);

    save();
    render();
  };

  // ▼ 編集
  window.editItem = function(id){
    const item = list.find(x => x.id === id);

    const name = prompt("キャラ名", item.name);
    if(name === null) return;

    const pri = prompt("優先度（高/中/低）", item.priority);
    if(pri === null) return;

    const s1 = prompt("1体目", item.slots[0]); if(s1===null) return;
    const s2 = prompt("2体目", item.slots[1]); if(s2===null) return;
    const s3 = prompt("3体目", item.slots[2]); if(s3===null) return;
    const s4 = prompt("4体目", item.slots[3]); if(s4===null) return;
    const s5 = prompt("5体目", item.slots[4]); if(s5===null) return;

    item.name = name;
    item.priority = pri;
    item.slots = [s1,s2,s3,s4,s5];

    save();
    render();
  };

  // ▼ 削除
  window.deleteItem = function(id){
    list = list.filter(x => x.id !== id);
    save();
    render();
  };

  // ▼ 一覧描画（検索対応）
  window.render = function(){
    const area = document.getElementById("itemList");
    area.innerHTML = "";

    const keyword = document.getElementById("searchBox").value.toLowerCase();

   const k = (keyword || "").toLowerCase();

const filtered = list.filter(item =>
  (item.name || "").toLowerCase().includes(k)
);


    filtered.forEach(item =>{
      const pClass =
        item.priority === "高" ? "priority-high" :
        item.priority === "中" ? "priority-mid" :
        "priority-low";

      const div = document.createElement("div");
      div.className = "item-card";

      div.innerHTML = `
        <div class="top-row">
          <label style="flex:1;">
            <input type="checkbox" ${item.done?"checked":""}
              onclick="toggleDone(${item.id})">
            <span class="${pClass}">[${item.priority}]</span>
            <strong>${item.name}</strong>
          </label>
        </div>

        <div style="display:flex; gap:8px; margin-top:8px;">
          <button style="background:#2196f3;" onclick="editItem(${item.id})">編集</button>
          <button style="background:#e53935;" onclick="deleteItem(${item.id})">削除</button>
        </div>

        <div>1体目: ${item.slots[0] || "-"}</div>
        <div>2体目: ${item.slots[1] || "-"}</div>
        <div>3体目: ${item.slots[2] || "-"}</div>
        <div>4体目: ${item.slots[3] || "-"}</div>
        <div>5体目: ${item.slots[4] || "-"}</div>
      `;

      area.appendChild(div);
    });
  };

</script>

</body>
</html>

